# Настройка платежных систем

## Настройка Telegram Payments

Для включения оплаты через Telegram Payments, необходимо выполнить следующие шаги:

1. Получите платежный токен от [BotFather](https://t.me/BotFather) в Telegram.
2. Для этого откройте чат с BotFather и выполните следующие действия:
   - Отправьте команду `/mybots`
   - Выберите вашего бота из списка
   - Нажмите "Payments"
   - Выберите платежную систему (например, "Yookassa", "Stripe" или другую)
   - Следуйте инструкциям BotFather для подключения платежной системы
   - После завершения настройки вы получите платежный токен

3. Добавьте полученный токен в файл `.env`:
   ```env
   TELEGRAM_PAYMENT_TOKEN=ваш_токен_здесь
   ```

   **ВАЖНО**: Без указания действительного токена кнопка оплаты через Telegram не будет работать, 
   и будет выдавать ошибку `BUTTON_TYPE_INVALID`. Если вы пока не хотите использовать 
   оплату через Telegram, выключите эту опцию:
   ```env
   ENABLE_TELEGRAM_PAYMENTS=false
   ```

4. Убедитесь, что переменная `ENABLE_TELEGRAM_PAYMENTS` установлена в `true`, только если у вас есть токен:
   ```env
   ENABLE_TELEGRAM_PAYMENTS=true
   ```

5. Перезапустите контейнер с ботом:
   ```bash
   docker compose restart app
   ```

## Настройка YooKassa для автоплатежей

Для включения автоматических платежей (автопродления подписок) через YooKassa:

1. Получите идентификатор метода оплаты для автоплатежей в личном кабинете YooKassa.
2. Добавьте его в файл `.env`:
   ```env
   YOOKASSA_AUTO_PAYMENT_METHOD_ID=ваш_идентификатор_метода
   ```

3. Убедитесь, что переменная `ENABLE_AUTO_RENEWAL` установлена в `true`:
   ```env
   ENABLE_AUTO_RENEWAL=true
   ```

4. Настройте дни для отправки напоминаний (через запятую):
   ```env
   REMINDER_DAYS=7,3,1
   ```

5. Перезапустите контейнер с ботом:
   ```bash
   docker compose restart app
   ```

## Тестирование платежей

После настройки платежных систем, рекомендуется выполнить тестовый платеж:

1. Запустите бота и выберите "Купить подписку"
2. Выберите тариф и способ оплаты
3. Убедитесь, что вы можете перейти на страницу оплаты (Telegram Payments или YooKassa)
4. Проверьте, что после успешной оплаты:
   - Создается запись о платеже в базе данных
   - Создается активная подписка
   - Пользователь получает соответствующие уведомления

Примечание: Для тестирования рекомендуется использовать тестовые платежные данные и тестовый режим платежных систем. 